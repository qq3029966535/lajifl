(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const s of h.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function e(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(l){if(l.ep)return;l.ep=!0;const h=e(l);fetch(l.href,h)}})();console.log("ç®€åŒ–æ¸¸æˆå¯åŠ¨...");class p{constructor(){this.canvas=null,this.ctx=null,this.isRunning=!1,this.time=0,this.selectedBinType=1,this.placedBins=[],this.tracks=[],this.trashItems=[],this.score=0,this.collectedCount=0,this.binConfig={1:{name:"å¨ä½™",color:"#4CAF50",collectTypes:["kitchen_waste"]},2:{name:"å¯å›æ”¶",color:"#2196F3",collectTypes:["recyclable"]},3:{name:"æœ‰å®³",color:"#F44336",collectTypes:["hazardous"]},4:{name:"å…¶ä»–",color:"#FF9800",collectTypes:["other"]}},this.trashConfig={kitchen_waste:{name:"å¨ä½™åƒåœ¾",color:"#8B4513",items:[{name:"é¦™è•‰çš®",icon:"ğŸŒ",color:"#FFD700"},{name:"è‹¹æœæ ¸",icon:"ğŸ",color:"#FF6B6B"},{name:"è¢‹è£…å¨ä½™",icon:"ğŸ¥¬",color:"#90EE90"},{name:"é±¼éª¨å¤´",icon:"ğŸŸ",color:"#C0C0C0"},{name:"è›‹å£³",icon:"ğŸ¥š",color:"#F5F5DC"},{name:"èœå¶",icon:"ğŸ¥¬",color:"#228B22"},{name:"å‰©é¥­",icon:"ğŸš",color:"#FFFACD"},{name:"æœçš®",icon:"ğŸŠ",color:"#FFA500"}]},recyclable:{name:"å¯å›æ”¶åƒåœ¾",color:"#1E90FF",items:[{name:"åºŸçº¸",icon:"ğŸ“„",color:"#F5F5F5"},{name:"å¡‘æ–™ç“¶",icon:"ğŸ¼",color:"#87CEEB"},{name:"ç»ç’ƒç“¶",icon:"ğŸ¾",color:"#98FB98"},{name:"åºŸé“",icon:"ğŸ”©",color:"#708090"},{name:"çº¸ç®±",icon:"ğŸ“¦",color:"#D2691E"},{name:"æ˜“æ‹‰ç½",icon:"ğŸ¥¤",color:"#C0C0C0"},{name:"æŠ¥çº¸",icon:"ğŸ“°",color:"#DCDCDC"},{name:"å¡‘æ–™è¢‹",icon:"ğŸ›ï¸",color:"#FFB6C1"}]},hazardous:{name:"æœ‰å®³åƒåœ¾",color:"#8B0000",items:[{name:"åºŸç”µæ± ",icon:"ğŸ”‹",color:"#2F4F4F"},{name:"åŒ–å­¦è¯å“",icon:"ğŸ§ª",color:"#9400D3"},{name:"è¿‡æœŸè¯å“",icon:"ğŸ’Š",color:"#FF1493"},{name:"åºŸç¯ç®¡",icon:"ğŸ’¡",color:"#FFFF00"},{name:"æ€è™«å‰‚",icon:"ğŸª²",color:"#8B0000"},{name:"æ²¹æ¼†æ¡¶",icon:"ğŸ¨",color:"#FF4500"},{name:"æ¸©åº¦è®¡",icon:"ğŸŒ¡ï¸",color:"#C0C0C0"},{name:"Xå…‰ç‰‡",icon:"ğŸ©»",color:"#2F2F2F"}]},other:{name:"å…¶ä»–åƒåœ¾",color:"#696969",items:[{name:"çƒŸå¤´",icon:"ğŸš¬",color:"#8B4513"},{name:"å°˜åœŸ",icon:"ğŸ’¨",color:"#A9A9A9"},{name:"ç¢ç“·å™¨",icon:"ğŸº",color:"#F0E68C"},{name:"æ¯›å‘",icon:"ğŸ’‡",color:"#654321"},{name:"çŒ«ç ‚",icon:"ğŸ±",color:"#D2B48C"},{name:"å£é¦™ç³–",icon:"ğŸ¬",color:"#FFB6C1"},{name:"çº¸å°¿è£¤",icon:"ğŸ‘¶",color:"#F0F8FF"},{name:"é™¶ç“·ç¢ç‰‡",icon:"ğŸº",color:"#CD853F"}]}},this.lastTrashSpawn=0,this.trashSpawnInterval=2e3,this.missedTrash=0,this.currentLevel=1,this.gameTime=0,this.levelTime=120,this.remainingTime=this.levelTime,this.gameState="playing",this.totalTrashSpawned=0,this.levelTrashTarget=20,this.levelConfig={1:{tracks:1,trashTypes:["kitchen_waste","recyclable","hazardous"],timeLimit:90,trashTarget:15,description:"åŸºç¡€3ç±»åƒåœ¾åˆ†ç±»"},2:{tracks:2,trashTypes:["kitchen_waste","recyclable","hazardous","other"],timeLimit:120,trashTarget:20,description:"å¢åŠ å…¶ä»–åƒåœ¾ç±»å‹"},3:{tracks:3,trashTypes:["kitchen_waste","recyclable","hazardous","other"],timeLimit:150,trashTarget:25,description:"3è½¨é“4ç±»åƒåœ¾"},4:{tracks:4,trashTypes:["kitchen_waste","recyclable","hazardous","other"],timeLimit:180,trashTarget:30,description:"4è½¨é“é«˜éš¾åº¦æŒ‘æˆ˜"},5:{tracks:5,trashTypes:["kitchen_waste","recyclable","hazardous","other"],timeLimit:210,trashTarget:35,description:"ç»ˆæ5è½¨é“æŒ‘æˆ˜"}},this.initializeLevel()}async init(){try{if(console.log("è·å–Canvaså…ƒç´ ..."),this.canvas=document.getElementById("game-canvas"),!this.canvas)throw new Error("æ‰¾ä¸åˆ°Canvaså…ƒç´ ");if(console.log("Canvaså…ƒç´ æ‰¾åˆ°:",this.canvas),console.log("Canvaså°ºå¯¸:",this.canvas.width,"x",this.canvas.height),this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("æ— æ³•è·å–2Dä¸Šä¸‹æ–‡");console.log("2Dä¸Šä¸‹æ–‡è·å–æˆåŠŸ"),this.setupEvents(),this.updateBinSelector(),this.initializeLevel(),this.start(),console.log("ç®€åŒ–æ¸¸æˆåˆå§‹åŒ–æˆåŠŸ")}catch(t){console.error("æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:",t),this.showError(t.message)}}initializeLevel(){this.tracks=[],this.placedBins=[],this.trashItems=[],this.totalTrashSpawned=0,this.gameTime=0,this.gameState="playing";const t=this.levelConfig[this.currentLevel];this.levelTime=t.timeLimit,this.remainingTime=this.levelTime,this.levelTrashTarget=t.trashTarget;const e=t.tracks,i=Math.min(80,this.canvas?(this.canvas.height-400)/e:80),l=280;for(let h=0;h<e;h++)this.tracks.push({id:h+1,y:l+h*i,startX:100,endX:1100,width:50,height:50});console.log(`åˆå§‹åŒ–å…³å¡ ${this.currentLevel}: ${e}æ¡è½¨é“, ${t.trashTypes.length}ç§åƒåœ¾ç±»å‹`)}setupEvents(){document.addEventListener("keydown",t=>{console.log("æŒ‰é”®:",t.key),t.key>="1"&&t.key<="4"&&(this.selectedBinType=parseInt(t.key),this.updateBinSelector(),console.log("é€‰æ‹©åƒåœ¾æ¡¶ç±»å‹:",this.selectedBinType))}),this.canvas.addEventListener("click",t=>{const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,l=t.clientY-e.top;console.log("é¼ æ ‡ç‚¹å‡»:",i,l),this.handleCanvasClick(i,l)}),document.querySelectorAll(".bin-option").forEach((t,e)=>{t.addEventListener("click",()=>{this.selectedBinType=e+1,this.updateBinSelector(),console.log("é€šè¿‡UIé€‰æ‹©åƒåœ¾æ¡¶ç±»å‹:",this.selectedBinType)})})}updateBinSelector(){document.querySelectorAll(".bin-option").forEach((t,e)=>{t.classList.remove("selected"),e+1===this.selectedBinType&&t.classList.add("selected")})}handleCanvasClick(t,e){for(const i of this.tracks)if(this.isPointOnTrack(t,e,i)){const l=this.placedBins.find(h=>h.trackId===i.id);l&&(this.removeBin(l.id),console.log("ç§»é™¤æ—§åƒåœ¾æ¡¶ï¼Œæ”¾ç½®æ–°åƒåœ¾æ¡¶")),this.placeBin(t,e,i.id);return}console.log("ç‚¹å‡»ä½ç½®ä¸åœ¨è½¨é“ä¸Š")}removeBin(t){const e=this.placedBins.findIndex(i=>i.id===t);e>-1&&(this.placedBins.splice(e,1),console.log("ç§»é™¤åƒåœ¾æ¡¶:",t))}isPointOnTrack(t,e,i){return t>=i.startX&&t<=i.endX&&e>=i.y&&e<=i.y+i.height}placeBin(t,e,i){const l=this.binConfig[this.selectedBinType],h=this.tracks.find(c=>c.id===i),s={id:Date.now(),type:this.selectedBinType,x:t,y:h.y+h.height/2,trackId:i,color:l.color,name:l.name,collectTypes:l.collectTypes,collectRadius:40};this.placedBins.push(s),console.log("æ”¾ç½®åƒåœ¾æ¡¶:",s)}start(){this.isRunning=!0,this.gameLoop(),console.log("æ¸¸æˆå¾ªç¯å¼€å§‹")}gameLoop(){this.isRunning&&(this.update(),this.render(),requestAnimationFrame(()=>this.gameLoop()))}update(){if(this.gameState==="playing"){if(this.time+=16,this.gameTime+=16,this.remainingTime=Math.max(0,this.levelTime-Math.floor(this.gameTime/1e3)),this.remainingTime<=0){this.checkGameOver();return}this.spawnTrash(),this.updateTrash(),this.checkCollisions(),this.checkLevelComplete()}}spawnTrash(){if(!(this.totalTrashSpawned>=this.levelTrashTarget||this.gameState!=="playing")&&this.time-this.lastTrashSpawn>this.trashSpawnInterval){const t=this.tracks[Math.floor(Math.random()*this.tracks.length)],i=this.levelConfig[this.currentLevel].trashTypes,l=i[Math.floor(Math.random()*i.length)],h=this.trashConfig[l],s=h.items[Math.floor(Math.random()*h.items.length)],c={id:Date.now()+Math.random(),type:l,name:s.name,x:t.endX+50,y:t.y+t.height/2,trackId:t.id,speed:40+Math.random()*20,color:s.color,icon:s.icon,collected:!1,size:25,categoryColor:h.color,hasShownError:!1,errorBins:[]};this.trashItems.push(c),this.totalTrashSpawned++,this.lastTrashSpawn=this.time,console.log(`ç”Ÿæˆåƒåœ¾ ${this.totalTrashSpawned}/${this.levelTrashTarget}: ${c.name}`)}}updateTrash(){for(let t=this.trashItems.length-1;t>=0;t--){const e=this.trashItems[t];if(!e.collected){e.x-=e.speed*(16/1e3);const i=this.tracks.find(l=>l.id===e.trackId);e.x<i.startX-50&&(this.trashItems.splice(t,1),this.missedTrash++,console.log(`åƒåœ¾æœªè¢«æ”¶é›†: ${e.name}ï¼Œå·²èµ°å®Œè½¨é“`),this.checkGameOver())}}}checkCollisions(){for(const t of this.trashItems)if(!t.collected)for(const e of this.placedBins)t.trackId===e.trackId&&Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<e.collectRadius&&(e.collectTypes.includes(t.type)?(t.collected=!0,this.score+=10,this.collectedCount++,console.log(`æ­£ç¡®æ”¶é›†: ${t.name} -> ${e.name}`),this.addCollectionEffect(e.x,e.y,!0)):t.errorBins.includes(e.id)||(t.errorBins.push(e.id),console.log(`é”™è¯¯åƒåœ¾æ¡¶: ${t.name} ä¸èƒ½è¢« ${e.name} æ”¶é›†ï¼Œç»§ç»­å‰è¿›`),this.addCollectionEffect(e.x,e.y,!1)));this.trashItems=this.trashItems.filter(t=>!t.collected)}addCollectionEffect(t,e,i){const l={x:t,y:e,text:i?"+10":"é”™è¯¯!",color:i?"#4CAF50":"#F44336",life:1e3,startTime:this.time};this.effects||(this.effects=[]),this.effects.push(l)}render(){try{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.ctx.createLinearGradient(0,0,0,this.canvas.height);t.addColorStop(0,"#98FB98"),t.addColorStop(.5,"#87CEEB"),t.addColorStop(1,"#F0FFF0"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#2E7D32",this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.fillText("ä¿å«å®¶å›­æ¸¸æˆ",this.canvas.width/2,100),this.ctx.fillStyle="#4CAF50",this.ctx.font="20px Arial",this.ctx.fillText("æ¸¸æˆæ­£åœ¨è¿è¡Œ...",this.canvas.width/2,150);for(const e of this.tracks)this.ctx.fillStyle="#87CEEB",this.ctx.fillRect(e.startX,e.y,e.endX-e.startX,e.height),this.ctx.strokeStyle="#4682B4",this.ctx.lineWidth=2,this.ctx.strokeRect(e.startX,e.y,e.endX-e.startX,e.height),this.ctx.fillStyle="#FFFFFF",this.ctx.font="12px Arial",this.ctx.textAlign="left",this.ctx.fillText(`è½¨é“ ${e.id}`,e.startX+10,e.y+25);for(const e of this.placedBins)this.ctx.save(),this.ctx.globalAlpha=.2,this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.collectRadius,0,Math.PI*2),this.ctx.fill(),this.ctx.restore(),this.drawBin(e.x,e.y,e.color,e.name,e.type===this.selectedBinType);this.drawBottomBinSelector();for(const e of this.trashItems)this.drawTrash(e);this.drawEffects(),this.drawHUD(),this.drawGameStateOverlay()}catch(t){console.error("æ¸²æŸ“é”™è¯¯:",t)}}drawGameStateOverlay(){if(this.gameState==="levelComplete")this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#4CAF50",this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.fillText("å…³å¡å®Œæˆï¼",this.canvas.width/2,this.canvas.height/2-50),this.ctx.fillStyle="#FFFFFF",this.ctx.font="24px Arial",this.ctx.fillText("æ­£åœ¨è¿›å…¥ä¸‹ä¸€å…³...",this.canvas.width/2,this.canvas.height/2+20),this.ctx.font="18px Arial",this.ctx.fillText(`å…³å¡ ${this.currentLevel} å®Œæˆ`,this.canvas.width/2,this.canvas.height/2+60),this.ctx.fillText(`æ”¶é›†åƒåœ¾: ${this.collectedCount}`,this.canvas.width/2,this.canvas.height/2+85),this.ctx.fillText("å¥–åŠ±åˆ†æ•°: +100",this.canvas.width/2,this.canvas.height/2+110),this.ctx.restore();else if(this.gameState==="gameComplete"){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 64px Arial",this.ctx.textAlign="center",this.ctx.fillText("ğŸ‰ æ­å–œé€šå…³ï¼ ğŸ‰",this.canvas.width/2,this.canvas.height/2-80),this.ctx.fillStyle="#4CAF50",this.ctx.font="bold 36px Arial",this.ctx.fillText("ç”Ÿæ€é˜²å¾¡å¤§å¸ˆï¼",this.canvas.width/2,this.canvas.height/2-20),this.ctx.fillStyle="#FFFFFF",this.ctx.font="24px Arial",this.ctx.fillText(`æœ€ç»ˆåˆ†æ•°: ${this.score}`,this.canvas.width/2,this.canvas.height/2+30),this.ctx.fillText(`æ€»æ”¶é›†åƒåœ¾: ${this.collectedCount}`,this.canvas.width/2,this.canvas.height/2+60);const t=this.collectedCount+this.missedTrash>0?Math.round(this.collectedCount/(this.collectedCount+this.missedTrash)*100):100;this.ctx.fillText(`æ€»å‡†ç¡®ç‡: ${t}%`,this.canvas.width/2,this.canvas.height/2+90),this.ctx.font="18px Arial",this.ctx.fillStyle="#CCCCCC",this.ctx.fillText("æ„Ÿè°¢æ‚¨ä¸ºç¯ä¿äº‹ä¸šåšå‡ºçš„è´¡çŒ®ï¼",this.canvas.width/2,this.canvas.height/2+130),this.ctx.restore()}}drawBin(t,e,i,l,h=!1,s=1){this.ctx.save(),h&&(this.ctx.shadowColor=i,this.ctx.shadowBlur=10);const c=30*s,o=40*s;this.ctx.fillStyle=i,this.ctx.fillRect(t-c/2,e-o/2,c,o),this.ctx.fillStyle=this.lightenColor(i,.2),this.ctx.fillRect(t-c/2-3,e-o/2-5,c+6,8),this.ctx.strokeStyle=this.darkenColor(i,.3),this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t-c/3,e-o/2-2,4,0,Math.PI,!0),this.ctx.arc(t+c/3,e-o/2-2,4,0,Math.PI,!0),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font=`bold ${10*s}px Arial`,this.ctx.textAlign="center",this.ctx.fillText(l,t,e+2),h&&(this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=3,this.ctx.strokeRect(t-c/2-2,e-o/2-7,c+4,o+12)),this.ctx.restore()}lightenColor(t,e){const i=t.replace("#",""),l=Math.min(255,parseInt(i.substr(0,2),16)+Math.round(255*e)),h=Math.min(255,parseInt(i.substr(2,2),16)+Math.round(255*e)),s=Math.min(255,parseInt(i.substr(4,2),16)+Math.round(255*e));return`rgb(${l}, ${h}, ${s})`}darkenColor(t,e){const i=t.replace("#",""),l=Math.max(0,parseInt(i.substr(0,2),16)-Math.round(255*e)),h=Math.max(0,parseInt(i.substr(2,2),16)-Math.round(255*e)),s=Math.max(0,parseInt(i.substr(4,2),16)-Math.round(255*e));return`rgb(${l}, ${h}, ${s})`}drawTrash(t){this.ctx.save(),t.errorBins&&t.errorBins.length>0&&(this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size/2+3,0,Math.PI*2),this.ctx.stroke()),this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size/2,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle=this.darkenColor(t.color,.4),this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.font="20px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.icon,t.x,t.y-2),this.ctx.fillStyle="#000000",this.ctx.font="bold 10px Arial",this.ctx.textBaseline="top",this.ctx.fillText(t.name,t.x,t.y+t.size/2+3);const e=this.trashConfig[t.type],i=this.ctx.measureText(e.name).width+8;this.ctx.fillStyle=t.categoryColor,this.ctx.fillRect(t.x-i/2,t.y-t.size/2-18,i,14),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 9px Arial",this.ctx.textBaseline="middle",this.ctx.fillText(e.name,t.x,t.y-t.size/2-11),t.errorBins&&t.errorBins.length>0&&(this.ctx.font="12px Arial",this.ctx.fillText("âš ï¸",t.x+t.size/2+5,t.y-t.size/2)),this.ctx.restore()}drawEffects(){if(this.effects)for(let t=this.effects.length-1;t>=0;t--){const e=this.effects[t],i=this.time-e.startTime;if(i>e.life){this.effects.splice(t,1);continue}const l=1-i/e.life,h=-i/10;this.ctx.save(),this.ctx.globalAlpha=l,this.ctx.fillStyle=e.color,this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText(e.text,e.x,e.y+h),this.ctx.restore()}}drawHUD(){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,400,100),this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=2,this.ctx.strokeRect(10,10,400,100),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left";const t=this.levelConfig[this.currentLevel];this.ctx.fillText(`å…³å¡ ${this.currentLevel}/5: ${t.description}`,20,30),this.ctx.fillText(`åˆ†æ•°: ${this.score}`,20,50);const e=Math.floor(this.remainingTime/60),i=this.remainingTime%60,l=`${e}:${i.toString().padStart(2,"0")}`;this.ctx.fillText(`æ—¶é—´: ${l}`,150,50);const h=`${this.totalTrashSpawned}/${this.levelTrashTarget}`;this.ctx.fillText(`åƒåœ¾è¿›åº¦: ${h}`,250,50),this.ctx.font="12px Arial",this.ctx.fillStyle="#CCCCCC",this.ctx.fillText(`å·²æ”¶é›†: ${this.collectedCount}`,20,70),this.ctx.fillText(`æœªæ”¶é›†: ${this.missedTrash}`,120,70),this.ctx.fillText(`å½“å‰åƒåœ¾: ${this.trashItems.length}`,220,70);const s=this.collectedCount+this.missedTrash>0?Math.round(this.collectedCount/(this.collectedCount+this.missedTrash)*100):100;this.ctx.fillText(`å‡†ç¡®ç‡: ${s}%`,320,70),this.ctx.fillText(`è½¨é“æ•°: ${this.tracks.length}`,20,90);const c=t.trashTypes.map(o=>this.trashConfig[o].name).join(", ");this.ctx.fillText(`åƒåœ¾ç±»å‹: ${c}`,120,90),this.ctx.restore()}drawBottomBinSelector(){this.ctx.save();const t=this.canvas.height-140,e=600,i=(this.canvas.width-e)/2;this.ctx.fillStyle="rgba(40, 40, 40, 0.95)",this.ctx.fillRect(i-20,t-20,e+40,120),this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=4,this.ctx.strokeRect(i-20,t-20,e+40,120),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 18px Arial",this.ctx.textAlign="center",this.ctx.fillText("é€‰æ‹©åƒåœ¾æ¡¶ç±»å‹ (æŒ‰æ•°å­—é”®1-4)",this.canvas.width/2,t-5);const h=this.levelConfig[this.currentLevel].trashTypes,c=[{id:1,name:"å¨ä½™",color:"#4CAF50",symbol:"ğŸ¥¬",type:"kitchen_waste"},{id:2,name:"å¯å›æ”¶",color:"#2196F3",symbol:"â™»ï¸",type:"recyclable"},{id:3,name:"æœ‰å®³",color:"#F44336",symbol:"â˜¢ï¸",type:"hazardous"},{id:4,name:"å…¶ä»–",color:"#FF9800",symbol:"ğŸ—‘ï¸",type:"other"}].filter(n=>h.includes(n.type)),o=c.length,x=Math.min(140,(e-40)/o),f=i+(e-o*x)/2+x/2;c.forEach((n,g)=>{const a=f+g*x,r=t+50,d=n.id===this.selectedBinType;this.ctx.fillStyle=d?"rgba(255, 255, 255, 0.15)":"rgba(255, 255, 255, 0.05)",this.ctx.fillRect(a-65,r-35,130,70),this.ctx.strokeStyle=d?n.color:"rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=d?4:2,this.ctx.strokeRect(a-65,r-35,130,70),d&&(this.ctx.shadowColor=n.color,this.ctx.shadowBlur=15,this.ctx.strokeStyle=n.color,this.ctx.lineWidth=3,this.ctx.strokeRect(a-63,r-33,126,66),this.ctx.shadowBlur=0),this.drawLargeBin(a,r-10,n.color,n.symbol,d),this.ctx.fillStyle=n.color,this.ctx.fillRect(a-60,r-30,25,20),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText(n.id.toString(),a-47.5,r-16),this.ctx.fillStyle=d?"#FFFFFF":"#CCCCCC",this.ctx.font="bold 14px Arial",this.ctx.fillText(n.name,a,r+25),h.includes(n.type)||(this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(a-65,r-35,130,70),this.ctx.fillStyle="#FF0000",this.ctx.font="bold 20px Arial",this.ctx.fillText("âœ—",a,r))}),this.ctx.restore()}drawLargeBin(t,e,i,l,h=!1){this.ctx.save();const s=50,c=55;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t-s/2+3,e-c/2+3,s,c+8);const o=this.ctx.createLinearGradient(t-s/2,e-c/2,t+s/2,e+c/2);o.addColorStop(0,this.lightenColor(i,.2)),o.addColorStop(.5,i),o.addColorStop(1,this.darkenColor(i,.2)),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.moveTo(t-s/2+4,e-c/2),this.ctx.lineTo(t+s/2-4,e-c/2),this.ctx.lineTo(t+s/2,e+c/2),this.ctx.lineTo(t-s/2,e+c/2),this.ctx.closePath(),this.ctx.fill();const x=this.ctx.createLinearGradient(t,e-c/2-8,t,e-c/2);x.addColorStop(0,this.lightenColor(i,.4)),x.addColorStop(1,this.lightenColor(i,.1)),this.ctx.fillStyle=x,this.ctx.fillRect(t-s/2-4,e-c/2-8,s+8,12),this.ctx.fillStyle=this.lightenColor(i,.6),this.ctx.fillRect(t-s/2-4,e-c/2-8,s+8,3),this.ctx.strokeStyle=this.darkenColor(i,.4),this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(t-s/3,e-c/2-2,6,0,Math.PI,!0),this.ctx.arc(t+s/3,e-c/2-2,6,0,Math.PI,!0),this.ctx.stroke(),this.ctx.strokeStyle=this.lightenColor(i,.3),this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(t-s/3-1,e-c/2-3,6,0,Math.PI,!0),this.ctx.arc(t+s/3-1,e-c/2-3,6,0,Math.PI,!0),this.ctx.stroke(),this.ctx.strokeStyle=this.darkenColor(i,.4),this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t-s/2+4,e-c/2),this.ctx.lineTo(t+s/2-4,e-c/2),this.ctx.lineTo(t+s/2,e+c/2),this.ctx.lineTo(t-s/2,e+c/2),this.ctx.closePath(),this.ctx.stroke(),this.ctx.strokeStyle=this.lightenColor(i,.4),this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t-s/2+4,e-c/2),this.ctx.lineTo(t-s/2,e+c/2),this.ctx.stroke(),this.ctx.strokeStyle=this.darkenColor(i,.2),this.ctx.lineWidth=1;for(let f=1;f<4;f++){const n=e-c/2+c*f/4;this.ctx.beginPath(),this.ctx.moveTo(t-s/2+6,n),this.ctx.lineTo(t+s/2-6,n),this.ctx.stroke()}this.ctx.font="32px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillText(l,t+1,e+1),this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(l,t,e),h&&(this.ctx.shadowColor=i,this.ctx.shadowBlur=20,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(t-s/2+4,e-c/2),this.ctx.lineTo(t+s/2-4,e-c/2),this.ctx.lineTo(t+s/2,e+c/2),this.ctx.lineTo(t-s/2,e+c/2),this.ctx.closePath(),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(t,e-c/2-15,8,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(t,e-c/2-15,4,0,Math.PI*2),this.ctx.fill()),this.ctx.restore()}checkLevelComplete(){this.totalTrashSpawned>=this.levelTrashTarget&&this.trashItems.length===0&&this.missedTrash===0&&(this.gameState="levelComplete",console.log(`å…³å¡ ${this.currentLevel} å®Œæˆï¼`),setTimeout(()=>{this.nextLevel()},2e3))}checkGameOver(){(this.missedTrash>0||this.remainingTime<=0)&&(this.gameState="gameOver",console.log("æ¸¸æˆå¤±è´¥ï¼"),this.showGameOverDialog())}nextLevel(){this.currentLevel<5?(this.currentLevel++,this.score+=100,this.initializeLevel(),console.log(`è¿›å…¥å…³å¡ ${this.currentLevel}`)):(this.gameState="gameComplete",console.log("æ­å–œï¼æ¸¸æˆå…¨éƒ¨å®Œæˆï¼"))}restartLevel(){this.missedTrash=0,this.collectedCount=0,this.score=Math.max(0,this.score-50),this.initializeLevel(),console.log(`é‡æ–°å¼€å§‹å…³å¡ ${this.currentLevel}`)}continueLevel(){this.gameState="playing",this.missedTrash=0,console.log(`ç»§ç»­å…³å¡ ${this.currentLevel}`)}showGameOverDialog(){const t=document.createElement("div");t.style.cssText=`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            border: 3px solid #F44336;
        `,t.innerHTML=`
            <h2 style="color: #F44336; margin-bottom: 20px;">å…³å¡å¤±è´¥ï¼</h2>
            <p style="margin-bottom: 20px;">åƒåœ¾é€šè¿‡äº†è½¨é“æˆ–æ—¶é—´å·²åˆ°</p>
            <button id="restart-btn" style="margin: 10px; padding: 10px 20px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">é‡æ–°å¼€å§‹</button>
            <button id="continue-btn" style="margin: 10px; padding: 10px 20px; font-size: 16px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">ç»§ç»­æœ¬å…³</button>
        `,document.body.appendChild(t),document.getElementById("restart-btn").onclick=()=>{document.body.removeChild(t),this.restartLevel()},document.getElementById("continue-btn").onclick=()=>{document.body.removeChild(t),this.continueLevel()}}showError(t){this.ctx&&(this.ctx.fillStyle="#FF0000",this.ctx.font="24px Arial",this.ctx.textAlign="center",this.ctx.fillText("é”™è¯¯: "+t,this.canvas.width/2,this.canvas.height/2)),console.error("æ¸¸æˆé”™è¯¯:",t)}}document.addEventListener("DOMContentLoaded",async()=>{console.log("DOMåŠ è½½å®Œæˆï¼Œå¯åŠ¨ç®€åŒ–æ¸¸æˆ");const m=new p;await m.init(),window.simpleGame=m});
